# Система управления библиотекой на FastAPI

## Описание
Этот проект представляет собой **систему управления библиотекой**, разработанную с использованием FastAPI. Приложение поддерживает аутентификацию, управление книгами и авторами, выдачу книг и операции с пользователями. Проект предоставляет удобные API-ручки для администраторов и пользователей.

## Важно:
- Так как задание тестовое .env файл был добавлен в репозиторий для быстрого поднятия приложения.
- На всякий случай описал содержиоме .env файла.

## Функционал
- **Аутентификация:** Токен-авторизация на основе OAuth2.  
- **Управление авторами:** Полный функционал CRUD для работы с авторами.  
- **Управление книгами:** Полный функционал CRUD для работы с книгами, включая фильтрацию по жанру и пагинацию.  
- **Управление выдачей:** Выдача и возврат книг с учетом аутентификации пользователей.  
- **Управление пользователями:** Регистрация пользователей, контроль доступа на основе ролей (admin/user), просмотр профиля.  

---

## Обзор API-ручек

### Аутентификация 
- `POST /auth/token`
  Генерация токена доступа для пользователей.  
  
---

### Авторы 
- `POST /authors/add_author`  
  Добавление нового автора.   


- `GET /authors/all_authors`  
  Получение списка всех авторов.  


- `GET /authors/author_id/{id}`  
  Получение информации об авторе по ID.  


- `PUT /authors/update_author/{id}`  
  Обновление данных автора.   


- `DELETE /authors/delete_author/{id}`  
  Удаление автора.

---

### Книги 
- `POST /books/add_books`  
  Добавление одной или нескольких книг.  

- `GET /books/get_books`  
  Получение списка всех книг с поддержкой фильтрации по жанру и пагинации.  


- `GET /books/books_id/{id}`  
  Получение информации о книге по ID.  

- `PUT /books/update_book/{id}`  
  Обновление данных книги.  


- `DELETE /books/delete_book/{id}`  
  Удаление книги.  
  

---

### Выдача книг 
- `GET /borrows/all_borrows`  
  Получение всех выданных книг.  
- 

- `POST /borrows/add_borrows`  
  Выдача книги пользователю.  
 

- `DELETE /borrows/delete_borrows/{id}`  
  Удаление записи о выдаче книги.
- 

- `PATCH /borrows/return_borrow`  
  Возврат книги пользователем.  
 
---

### Пользователи 
- `POST /users/register`  
  Регистрация нового пользователя.  


- `GET /users/all_users`  
  Получение списка всех пользователей (доступно только для администраторов).  
-  Пользователи с ролью `user` получат ошибку **403 Forbidden**.  


- `POST /users/update_user`  
  Обновление данных текущего пользователя.  
  

- `GET /users/me`  
  Просмотр данных текущего пользователя.  

---

## Установка

### Требования
- Python 3.10+
- PostgreSQL
- SQLAlchemy
- Pydantic
- Виртуальное окружение (опционально)

### Клонирование репозитория
```
git clone https://github.com/Equialy/library_patres.git
cd library_patres
```



### Развертывание через Docker

Для использование Docker-compose выполните следующие шаги находясь в корне проекта:
```
docker compose build
```
```
docker compose up
```

- Запустится база и прогонятся миграции автоматически.

```
Октрыть в браузере по адресу http://localhost:8003/docs
```



### Локальное развертывание
Настройка окружения
1. Создайте виртуальное окружение:
```
python -m venv venv
source venv/bin/activate  # В Windows: venv\Scripts\activate
```

2. Установите зависимости:
```
pip install -r requirements.txt
```
3. Создайте файл .env в корневой папке проекта со следующим содержимым:
```
#DataBase
PG_HOST=youre_host
PG_PORT=youre_port
PG_USER=your_user
PG_PASSWORD=youer_password
PG_DB_NAME=your_db_name

#AuthSecrets
SECRET_KEY=your_secret_key
ALGORITHM=your_algorithm
CRYPT_SCHEMA=your_schema
```
4. Применение миграций базы данных:
```
alembic upgrade head
```
6. Запуск сервера:
```
uvicorn src.main:app --reload
```
